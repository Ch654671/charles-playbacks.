<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Charles Playbacks</title>
<style>
:root{--bg:#000;--card:#111214;--accent:#e11d2f;--accent-grad:linear-gradient(135deg,#e11d2f,#ff6f61);--muted:#9aa0a6;}
body{margin:0;background:var(--bg);color:#fff;font-family:sans-serif;}
header{display:flex;justify-content:space-between;padding:12px 16px;background:#081018;border-radius:12px;align-items:center;box-shadow:0 4px 12px rgba(0,0,0,0.5);}
.logo{display:flex;gap:12px;align-items:center;transition:transform .3s;}
.logo:hover{transform:scale(1.05);}
.logo .mark{width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:22px;
background:var(--accent-grad);color:#fff;text-shadow:0 2px 6px rgba(0,0,0,0.5);}
aside{width:250px;background:var(--card);padding:12px;border-radius:12px;float:left;height:calc(100vh - 80px);}
main{margin-left:270px;padding:12px;}
.nav-btn{display:block;padding:10px;border-radius:10px;color:#ddd;text-decoration:none;margin-bottom:8px;border:1px solid rgba(255,255,255,0.03);transition:0.2s;}
.nav-btn:hover{background:var(--accent);color:#fff;}
.nav-btn.active{background:var(--accent);color:#fff;}
button{cursor:pointer;border:0;padding:8px 12px;border-radius:8px;transition:0.2s;}
button:hover{opacity:0.85;}
.btn-red{background:var(--accent);color:#fff;}
.btn-dark{background:#0b0b0b;color:#ddd;border:1px solid #222;}
.hidden{display:none;}
.grid{display:grid;gap:12px;}
.grid-cols-3{grid-template-columns:repeat(auto-fill,minmax(200px,1fr));}
.item{background:#111;padding:10px;border-radius:8px;transition:0.2s;}
.item:hover{transform:scale(1.02);}
.cover{width:100%;height:160px;object-fit:cover;border-radius:6px;}
.muted{color:var(--muted);font-size:13px;}
.price{font-weight:800;color:var(--accent);font-size:16px;}
footer{margin-top:20px;text-align:center;color:var(--muted);}
.download-link{display:block;margin:6px 0;color:var(--accent);}
.qrcode{margin:12px 0;}
.audio-player{width:100%;margin-top:6px;margin-bottom:6px;}
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="mark">CP</div>
    <div>Charles Playbacks</div>
  </div>
  <div><button id="btnCart" class="btn-dark">Carrinho (<span id="cartCount">0</span>)</button></div>
</header>

<aside>
  <a href="#" class="nav-btn active" data-view="playbacks">Playbacks</a>
  <a href="#" class="nav-btn" data-view="cart">Carrinho</a>
  <a href="#" class="nav-btn" data-view="downloads">Meus Downloads</a>
  <a href="#" class="nav-btn" data-view="admin">Admin</a>
  <a href="#" class="nav-btn" data-view="promo">Promoção</a>
</aside>

<main>
<!-- PLAYBACKS -->
<section id="playbacks" class="view">
  <h2>Playbacks</h2>
  <div id="catalogGrid" class="grid grid-cols-3"></div>
</section>

<!-- CARRINHO -->
<section id="cart" class="view hidden">
  <h2>Carrinho</h2>
  <div id="cartItems"></div>
  <div>Total: R$ <span id="cartTotal">0.00</span></div>
  <div id="checkoutArea" class="hidden">
    <h3>PIX</h3>
    <div id="qrcode" class="qrcode"></div>
    <button id="btnConfirmPayment" class="btn-red">Confirmar Pagamento</button>
  </div>
  <button id="btnClearCart" class="btn-dark">Limpar Carrinho</button>
  <button id="btnCheckout" class="btn-red">Gerar QR Code PIX</button>
</section>

<!-- DOWNLOADS -->
<section id="downloads" class="view hidden">
  <h2>Meus Downloads</h2>
  <div id="downloadsList" class="grid grid-cols-3"></div>
</section>

<!-- ADMIN -->
<section id="admin" class="view hidden">
  <h2>Admin</h2>
  <div id="adminLoginDiv">
    <input type="password" id="adminPass" placeholder="Senha Admin"/>
    <button id="btnLoginAdmin" class="btn-red">Entrar</button>
  </div>
  <div id="adminPanel" class="hidden">
    <h3>Cadastrar Playback</h3>
    <input type="text" id="upName" placeholder="Nome do playback"/><br>
    <input type="number" id="upPrice" placeholder="Preço R$" step="0.01"/><br>
    <input type="file" id="upCover" accept="image/*"/><br>
    <input type="file" id="upAudio" accept="audio/*"/><br>
    <button id="btnCreateItem" class="btn-red">Cadastrar Playback</button>
    <h3>Pedidos Pendentes</h3>
    <div id="ordersList"></div>
  </div>
</section>

<!-- PROMOÇÃO -->
<section id="promo" class="view hidden">
  <h2>Promoção</h2>
  <p>Exemplo: Leve 5, Pague 4</p>
  <div>
    <label>Qtd mínima:</label>
    <input type="number" id="promoMin" value="5"/>
    <label>Qtd paga:</label>
    <input type="number" id="promoPay" value="4"/>
    <button id="btnApplyPromo" class="btn-red">Aplicar Promoção</button>
  </div>
</section>

<footer>
&copy; 2025 Charles — Playbacks
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
// STORAGE
let items = JSON.parse(localStorage.getItem('items')||'[]');
let cart = JSON.parse(localStorage.getItem('cart')||'[]');
let orders = JSON.parse(localStorage.getItem('orders')||'[]');
let downloads = JSON.parse(localStorage.getItem('downloads')||'[]');
let promo={min:5,pay:4};

function saveLS(){
  localStorage.setItem('items',JSON.stringify(items));
  localStorage.setItem('cart',JSON.stringify(cart));
  localStorage.setItem('orders',JSON.stringify(orders));
  localStorage.setItem('downloads',JSON.stringify(downloads));
}

// NAVIGATION
const views=document.querySelectorAll('.view');
document.querySelectorAll('.nav-btn').forEach(btn=>{
  btn.addEventListener('click',e=>{
    e.preventDefault();
    views.forEach(v=>v.classList.add('hidden'));
    document.getElementById(btn.dataset.view).classList.remove('hidden');
    document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    if(btn.dataset.view=='downloads') renderDownloads();
    if(btn.dataset.view=='admin') renderOrders();
  });
});
document.getElementById('btnCart').addEventListener('click',()=>{views.forEach(v=>v.classList.add('hidden'));document.getElementById('cart').classList.remove('hidden');renderCart();});

// PLAYBACKS
function renderCatalog(){
  const grid=document.getElementById('catalogGrid');
  grid.innerHTML='';
  items.forEach((i,idx)=>{
    const div=document.createElement('div');
    div.className='item';
    div.innerHTML=`
      <img class="cover" src="${i.cover}">
      <b>${i.name}</b>
      <div class="price">R$ ${i.price.toFixed(2)}</div>
      <audio class="audio-player" controls src="${i.audio}" data-full="${i.audio}"></audio>
      <button class="btn-red">Adicionar ao Carrinho</button>
    `;
    const audioEl = div.querySelector('audio');
    audioEl.addEventListener('timeupdate',()=>{
      if(audioEl.currentTime>=60){
        audioEl.pause();
        audioEl.currentTime=0;
        alert("Demo finalizada! Compre para ouvir completo.");
      }
    });
    div.querySelector('button').addEventListener('click',()=>{
      cart.push(i); saveLS(); renderCart(); updateCartCount();
    });
    grid.appendChild(div);
  });
}

// CART
function renderCart(){
  const el=document.getElementById('cartItems');
  el.innerHTML='';
  if(cart.length===0){el.innerHTML='<div class="muted">Carrinho vazio</div>';updateCartCount();return;}
  let total=0;
  cart.forEach((i,idx)=>{
    const div=document.createElement('div');
    div.innerHTML=`${i.name} - R$ ${i.price.toFixed(2)} <button onclick="removeCart(${idx})" class="btn-dark">Remover</button>`;
    el.appendChild(div);
    total+=i.price;
  });
  if(cart.length>=promo.min){total-=cart[0].price*(cart.length - promo.pay);}
  document.getElementById('cartTotal').innerText=total.toFixed(2);
}
function removeCart(idx){cart.splice(idx,1);saveLS();renderCart();updateCartCount();}
document.getElementById('btnClearCart').addEventListener('click',()=>{cart=[];saveLS();renderCart();updateCartCount();});
function updateCartCount(){document.getElementById('cartCount').innerText=cart.length;}

// CHECKOUT
document.getElementById('btnCheckout').addEventListener('click',()=>{
  if(cart.length===0){alert('Carrinho vazio!'); return;}
  document.getElementById('checkoutArea').classList.remove('hidden');
  document.getElementById('qrcode').innerHTML='';
  const total=cart.reduce((a,b)=>a+b.price,0);
  new QRCode(document.getElementById("qrcode"),{
    text:`PIX Exemplo\nValor: R$ ${total.toFixed(2)}`,
    width:128,height:128
  });
});

// CONFIRM PAYMENT (AGORA NÃO LIBERA MAIS DIRETO)
document.getElementById('btnConfirmPayment').addEventListener('click',()=>{
  if(cart.length===0){alert('Carrinho vazio'); return;}
  orders.push({items:[...cart], paid:false}); // fica pendente
  cart=[];
  saveLS();
  renderCart();
  updateCartCount();
  document.getElementById('checkoutArea').classList.add('hidden');
  alert('Prazo de entrega em até 2 hrs logo após enviar o comprovante!');
  // redirecionar pro WhatsApp
  window.location.href="https://wa.me/5599999999999?text=Olá,%20segue%20meu%20comprovante%20de%20pagamento!";
});

// DOWNLOADS
function renderDownloads(){
  const el=document.getElementById('downloadsList');
  el.innerHTML='';
  if(downloads.length===0){el.innerHTML='<div class="muted">Nenhum playback comprado ainda.</div>'; return;}
  downloads.forEach(it=>{
    const a=document.createElement('a');
    a.href=it.audio;a.download='';a.innerText=it.name;a.className='download-link';
    el.appendChild(a);
  });
}

// ADMIN LOGIN
document.getElementById('btnLoginAdmin').addEventListener('click',()=>{
  const pass=document.getElementById('adminPass').value;
  if(pass==='C626G7@#'){document.getElementById('adminPanel').classList.remove('hidden');document.getElementById('adminLoginDiv').classList.add('hidden'); renderOrders();}
  else{alert('Senha incorreta!');}
});

// ADMIN UPLOAD
document.getElementById('btnCreateItem').addEventListener('click',()=>{
  const name=document.getElementById('upName').value;
  const price=parseFloat(document.getElementById('upPrice').value);
  const coverFile=document.getElementById('upCover').files[0];
  const audioFile=document.getElementById('upAudio').files[0];
  if(!name||!price||!coverFile||!audioFile){alert('Preencha todos os campos!'); return;}
  const readerCover=new FileReader();
  const readerAudio=new FileReader();
  readerCover.onload=e=>{
    readerAudio.onload=ev=>{
      items.push({name,price,cover:e.target.result,audio:ev.target.result});
      saveLS(); renderCatalog(); alert('Playback cadastrado!');
      document.getElementById('upName').value=''; document.getElementById('upPrice').value=''; document.getElementById('upCover').value=''; document.getElementById('upAudio').value='';
      views.forEach(v=>v.classList.add('hidden'));
      document.getElementById('playbacks').classList.remove('hidden');
      document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
      document.querySelector('[data-view="playbacks"]').classList.add('active');
    };
    readerAudio.readAsDataURL(audioFile);
  };
  readerCover.readAsDataURL(coverFile);
});

// ADMIN ORDERS (ADMIN LIBERA MANUALMENTE)
function renderOrders(){
  const el=document.getElementById('ordersList');
  el.innerHTML='';
  orders.forEach((o,idx)=>{
    const div=document.createElement('div');
    div.innerHTML=`Pedido ${idx+1}: ${o.items.map(i=>i.name).join(', ')} - ${o.paid?'Liberado':'Pendente'} <button onclick="toggleOrder(${idx})" class="btn-dark">${o.paid?'Bloquear':'Liberar'}</button>`;
    el.appendChild(div);
  });
}

function toggleOrder(idx){
  orders[idx].paid=!orders[idx].paid;
  if(orders[idx].paid) downloads.push(...orders[idx].items);
  else orders[idx].items.forEach(i=>{downloads=downloads.filter(d=>d.name!==i.name)});
  saveLS();
  renderOrders();
}

// PROMOÇÃO
document.getElementById('btnApplyPromo').addEventListener('click',()=>{
  promo.min=parseInt(document.getElementById('promoMin').value);
  promo.pay=parseInt(document.getElementById('promoPay').value);
  alert('Promoção atualizada!');
  renderCart();
});

// INITIALIZE
renderCatalog();
updateCartCount();
</script>

</body>
</html>